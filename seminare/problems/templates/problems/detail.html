{% extends "base.html" %}
{% load markdownify %}
{% load ui %}

{% block title %}{{ problem.name }} {{ block.super }}{% endblock %}

{% block body_container %}
<div class="border-b px-4 py-3">
  {% url "problem_set_list" as set_list_url %}
  {% url "problem_set_detail" problem.problem_set.slug as set_url %}
  {% if solution %}
    {% url "problem_detail" problem.problem_set.slug problem.number as problem_url %}
    {% breadcrumbs "Zadania" set_list_url problem.problem_set set_url problem problem_url "Riešenie" %}
  {% else %}
    {% breadcrumbs "Zadania" set_list_url problem.problem_set set_url problem %}
  {% endif %}
</div>

<div data-controller="submit--cta">
  <div class="flex flex-col lg:flex-row" data-controller="toggle" data-toggle-toggle-class="hidden">
    {% include "problems/_sidebar.html" with problem_set=problem.problem_set %}

    <div class="flex-1 p-4 lg:py-8">
      <div class="mx-auto max-w-prose">
        <a href="#" class="mb-2 flex justify-end items-center text-blue-700 hover:text-blue-900 lg:hidden"
            data-action="click->toggle#click">
          Zoznam úloh
          <iconify-icon icon="mdi:chevron-down" class="ml-1"></iconify-icon>
        </a>

        {% include "org/generic/_title.html" with title=problem %}

        {% if solution %}
          {% if texts.PS.is_visible or is_organizer %}
            <details class="py-2 px-4 mb-4 border bg-gray-100 rounded-md">
              <summary>Zadanie</summary>
              <div class="prose my-6">
                {% if not texts.PS.is_visible %}
                  {% message "Túto sekciu vidíš, lebo si organizátor" "warning" %}
                {% endif %}
                {{ texts.PS.text|markdownify:problem }}
              </div>
            </details>
          {% endif %}

          {% if texts.ES.is_visible or is_organizer %}
            {% if not texts.ES.is_visible %}
              {% message "Túto sekciu vidíš, lebo si organizátor" "warning" %}
            {% endif %}
            <div class="prose">
              {{ texts.ES.text|markdownify:problem }}
            </div>
          {% endif %}
        {% else %}
          {% if texts.ES.is_visible or is_organizer %}
            <div class="border rounded items-center py-2 px-4 mb-4 shrink-0 border-blue-700/40 text-blue-700 bg-blue-100">
              Kolo už skončilo. Môžeš si pozrieť <a class="link" href="{% url "problem_solution" problem.problem_set.slug problem.number %}">vzorové riešenie</a>.
            </div>
          {% endif %}

          {% if texts.PS.is_visible or is_organizer %}
            {% if not texts.PS.is_visible %}
              {% message "Túto sekciu vidíš, lebo si organizátor" "warning" %}
            {% endif %}
            <div class="prose">
              {{ texts.PS.text|markdownify:problem }}
            </div>
          {% endif %}
        {% endif %}
      </div>
    </div>

    <div class="lg:border-l p-4 shrink-0">
      <div class="lg:w-80 max-w-prose mx-auto">
        {% include "problems/_submit_sidebar.html" %}
      </div>
    </div>
  </div>

  <div class="fixed inset-x bottom-0 z-30 w-full p-4 flex items-center lg:hidden" data-submit--cta-target="cta">
    <button type="button" data-action="submit--cta#scroll" class="flex items-center gap-2 px-4 py-2 rounded-full bg-gray-800 text-white mx-auto w-auto shadow-lg" id="scroll">
      Odovzdávanie
      <iconify-icon icon="mdi:arrow-down"></iconify-icon>
    </button>
  </div>
</div>
{% endblock %}
